{% extends "base.html" %}



{% block content %}
<!-- Breadcrumb & Header -->
<div class="bg-surface-container-low py-3 px-4 sm:px-6 lg:px-8 border-b border-outline-variant mb-6">
    <div class="max-w-7xl mx-auto flex items-center text-sm text-on-surface-variant">
        <a href="/" class="hover:text-primary font-medium">ANASAYFA</a>
        <span class="mx-2 text-outline">/</span>
        <span class="text-on-surface font-medium">Yerleşim Bekleyenler</span>
    </div>
</div>

<div class="max-w-[95%] mx-auto px-4 sm:px-6 lg:px-8 pb-12">
    <div class="bg-surface rounded-lg shadow-sm border border-outline-variant overflow-hidden">
        
        <!-- Controls -->
        <div class="p-4 border-b border-outline-variant flex flex-col sm:flex-row justify-between items-center gap-4 bg-surface-container-lowest">
            <div class="flex items-center gap-2 text-sm text-on-surface-variant">
                <span>Sayfada</span>
                <select id="entriesPerPage" class="form-select py-1 px-2 border border-outline rounded text-sm focus:ring-primary focus:border-primary bg-surface text-on-surface">
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
                <span>Kayıt Göster</span>
            </div>
            
            <div class="flex items-center gap-2 text-sm text-on-surface-variant w-full sm:w-auto">
                <span>Bul:</span>
                <input type="text" id="searchInput" class="form-input py-1 px-3 border border-outline rounded text-sm focus:ring-primary focus:border-primary w-full sm:w-64 bg-surface text-on-surface" placeholder="">
            </div>
        </div>
        
        <!-- Table -->
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-outline-variant" id="membersTable">
                <thead class="bg-surface-container-low">
                    <tr>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-bold text-on-surface uppercase tracking-wider cursor-pointer hover:bg-surface-container group select-none" onclick="sortTable(0)">
                            <div class="flex items-center justify-between">
                                Üye No
                                <span class="material-symbols-outlined text-[16px] text-outline group-hover:text-on-surface">unfold_more</span>
                            </div>
                        </th>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-bold text-on-surface uppercase tracking-wider cursor-pointer hover:bg-surface-container group select-none" onclick="sortTable(1)">
                            <div class="flex items-center justify-between">
                                Adı Soyadı
                                <span class="material-symbols-outlined text-[16px] text-outline group-hover:text-on-surface">unfold_more</span>
                            </div>
                        </th>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-bold text-on-surface uppercase tracking-wider cursor-pointer hover:bg-surface-container group select-none" onclick="sortTable(2)">
                            <div class="flex items-center justify-between">
                                E-posta
                                <span class="material-symbols-outlined text-[16px] text-outline group-hover:text-on-surface">unfold_more</span>
                            </div>
                        </th>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-bold text-on-surface uppercase tracking-wider cursor-pointer hover:bg-surface-container group select-none" onclick="sortTable(3)">
                            <div class="flex items-center justify-between">
                                GSM
                                <span class="material-symbols-outlined text-[16px] text-outline group-hover:text-on-surface">unfold_more</span>
                            </div>
                        </th>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-bold text-on-surface uppercase tracking-wider cursor-pointer hover:bg-surface-container group select-none" onclick="sortTable(4)">
                            <div class="flex items-center justify-between">
                                Kayıt Tarihi
                                <span class="material-symbols-outlined text-[16px] text-outline group-hover:text-on-surface">unfold_more</span>
                            </div>
                        </th>
                        <th scope="col" class="px-4 py-3 text-right text-xs font-bold text-on-surface uppercase tracking-wider">
                            İşlem
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-surface divide-y divide-outline-variant text-sm text-on-surface-variant" id="tableBody">
                    {% for uye in uyeler %}
                    <tr class="hover:bg-surface-container transition-colors odd:bg-surface even:bg-surface-container-lowest">
                        <td class="px-4 py-3 whitespace-nowrap font-medium text-on-surface">
                            {{ uye.uye_no if uye.uye_no else uye.id }}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            {{ uye.tam_ad }}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            {{ uye.email }}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            {{ uye.telefon }}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            {{ uye.kayit_tarihi.strftime('%d.%m.%Y %H:%M') if uye.kayit_tarihi else '-' }}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-right">
                            <a href="/panel/agac/{{ request.state.user.id }}?selected_waiting_user={{ uye.id }}" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-on-primary bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary shadow-sm transition-all">
                                <span class="material-symbols-outlined text-[16px] mr-1">account_tree</span>
                                Ağaca Yerleştir
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        <div class="p-4 border-t border-gray-200 bg-gray-50 flex items-center justify-between">
            <div class="text-sm text-gray-600">
                Toplam <span id="totalEntries" class="font-medium text-gray-900">{{ uyeler|length }}</span> kayıttan <span id="showingStart" class="font-medium text-gray-900">1</span> - <span id="showingEnd" class="font-medium text-gray-900">10</span> arası gösteriliyor
            </div>
            <div class="flex gap-1" id="paginationControls">
                <!-- JS ile doldurulacak -->
            </div>
        </div>
    </div>
</div>

<script>
    // Basit Tablo İşlemleri (Arama, Sıralama, Sayfalama)
    document.addEventListener('DOMContentLoaded', function() {
        const table = document.getElementById('membersTable');
        const tbody = document.getElementById('tableBody');
        const rows = Array.from(tbody.querySelectorAll('tr'));
        const searchInput = document.getElementById('searchInput');
        const entriesSelect = document.getElementById('entriesPerPage');
        
        let currentPage = 1;
        let rowsPerPage = parseInt(entriesSelect.value);
        let currentRows = [...rows];
        
        // Arama
        searchInput.addEventListener('input', function(e) {
            const term = e.target.value.toLowerCase();
            currentRows = rows.filter(row => {
                return row.textContent.toLowerCase().includes(term);
            });
            currentPage = 1;
            updateTable();
        });
        
        // Sayfa Başına Kayıt
        entriesSelect.addEventListener('change', function(e) {
            rowsPerPage = parseInt(e.target.value);
            currentPage = 1;
            updateTable();
        });
        
        // Tablo Güncelleme
        function updateTable() {
            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            
            // Tüm satırları gizle
            rows.forEach(row => row.style.display = 'none');
            
            // Filtrelenmiş ve sayfalanmış satırları göster
            currentRows.slice(start, end).forEach(row => row.style.display = '');
            
            // Bilgi metnini güncelle
            document.getElementById('totalEntries').textContent = currentRows.length;
            document.getElementById('showingStart').textContent = currentRows.length > 0 ? start + 1 : 0;
            document.getElementById('showingEnd').textContent = Math.min(end, currentRows.length);
            
            renderPagination();
        }
        
        // Sayfalama Kontrolleri
        function renderPagination() {
            const totalPages = Math.ceil(currentRows.length / rowsPerPage);
            const container = document.getElementById('paginationControls');
            container.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // Önceki
            const prevBtn = document.createElement('button');
            prevBtn.className = `px-3 py-1 border border-outline rounded text-sm ${currentPage === 1 ? 'bg-surface-container-low text-on-surface-variant/50 cursor-not-allowed' : 'bg-surface text-on-surface-variant hover:bg-surface-container'}`;
            prevBtn.textContent = 'Önceki';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => { currentPage--; updateTable(); };
            container.appendChild(prevBtn);
            
            // Sayfalar
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    const btn = document.createElement('button');
                    btn.className = `px-3 py-1 border rounded text-sm ${currentPage === i ? 'bg-primary text-on-primary border-primary' : 'bg-surface text-on-surface-variant border-outline hover:bg-surface-container'}`;
                    btn.textContent = i;
                    btn.onclick = () => { currentPage = i; updateTable(); };
                    container.appendChild(btn);
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    const span = document.createElement('span');
                    span.className = 'px-2 py-1 text-on-surface-variant/50';
                    span.textContent = '...';
                    container.appendChild(span);
                }
            }
            
            // Sonraki
            const nextBtn = document.createElement('button');
            nextBtn.className = `px-3 py-1 border border-outline rounded text-sm ${currentPage === totalPages ? 'bg-surface-container-low text-on-surface-variant/50 cursor-not-allowed' : 'bg-surface text-on-surface-variant hover:bg-surface-container'}`;
            nextBtn.textContent = 'Sonraki';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => { currentPage++; updateTable(); };
            container.appendChild(nextBtn);
        }
        
        // Sıralama (Basit string karşılaştırma)
        window.sortTable = function(n) {
            const asc = table.getAttribute('data-order') !== 'asc';
            table.setAttribute('data-order', asc ? 'asc' : 'desc');
            
            currentRows.sort((a, b) => {
                const valA = a.children[n].textContent.trim();
                const valB = b.children[n].textContent.trim();
                return asc ? valA.localeCompare(valB) : valB.localeCompare(valA);
            });
            
            updateTable();
        };
        
        // İlk yükleme
        updateTable();
    });
</script>
{% endblock %}